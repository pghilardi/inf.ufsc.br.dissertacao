\chapter{Especificação de Sistemas Orientados a Aspectos}O meta-modelo padrão da UML não permite a especificação de todas as características de sistemas orientados a aspectos. Este trabalho define um perfilUML que estende a linguagem com novas construções, permitindo a modelagem de sistemas que utilizam aspectos. Este capítulo descreve os estereótipos,valores rotulados e restrições propostas por este perfil e também apresenta uma abordagem para representação das características estruturais ecomportamentais de aspectos, fornecendo subsídios para composição automática de modelos de aspectos com modelos núcleo do sistema.\section{Modelagem estrutural e dinãmica}A figura \ref{fig:uml_profile} apresenta o perfil UML proposto para representar a estrutura e o comportamento de aplicações orientadas a aspectos.Este perfil pode ser utilizado em ferramentas CASE que suportem a importação de perfis através do padrão XML Metadata Interchange (XMI) para troca demeta-dados via Extensible Markup Language (XML). Para modelagem estrutural, este trabalho utiliza algumas definições do trabalho proposto por Evermann \cite{Evermann:2007:MSP:1229375.1229379}, o qualpermite a representação das características estruturais de aspectos. As definições usadas do perfil de Evermann são os estereótipos \textit{CrosscuttingConcern} e \textit{Aspect}, que estão com o fundo bege no diagrama de perfil da figura\ref{fig:uml_profile}. Um estereótipo estende um elemento do meta-modelo da UML, adicionando uma nova semântica a um elemento do modelo. Nestetrabalho, um elemento do meta-modelo a ser estendido é representado dentro de parênteses. O estereótipo \textit{CrosscuttingConcern} estende(\textit{Package}) e contém um conjunto de classes e aspectos, representando um interesse que impacta uma ou mais partes de um sistema. O estereótipo\textit{Aspect} estende (\textit{Class}), contém declarações inter-tipos (introduções) e algumas propriedades de configuração como: tipo deinstanciação de um aspecto, ponto de corte associado e uma variável de controle para informar se o aspecto é privilegiado ou não. As declaraçõesinter-tipos permitem a injeção de membros (métodos, atributos) em uma classe, mudanças de hierarchia de herança entre classes e de implementação deinterfaces. Para representar declarações inter-tipos, foi proposto o estereótipo \textit{ClassExtension}. Este estereótipo estende (\textit{Class}) eestá associado a outro estereótipo denominado \textit{Introduction}. O estereótipo \textit{Introduction} é usado para marcar quais membros estão sendoinseridos em uma classe, ou qual relacionamento de herança está sendo adicionado ou removido, ou qual interface está sendo implementada. O estereótipo\texit{Introduction} estende os elementos do meta-modelo (\textit{Attribute}), (\textit{Operation}), (\textit{Generalization}) e(\textit{Realization}).\begin{figure}[!h] \centering	\includegraphics{img/full_profile.png}	\caption{Perfil UML para Modelagem de Sistemas Orientados a Aspectos.}\label{fig:uml_profile}\end{figure}Com os estereótipos propostos e o diagrama de classes da UML é possível representar a estrutura de aplicações orientadas a aspectos usandopacotes, classes e aspectos. O exemplo da figura \ref{fig:structural_profile_example} mostra como modelar um interesse entrecortante usando o perfilUML proposto por esta dissertação. Alguns dos exemplos apresentados são baseados no sistema de gerenciamento de hotéis proposto por Jacobson paraapresentar sua proposta de modelagem \cite{Jacobson:2004:ASD:1062430}. O interesse sendo modelado é a capacidade de um objeto ter seu estado copiadopara outro objeto. A funcionalidade \textit{Copyable} é especificada como um interesse entrecortante que contém o aspecto\textit{CopyableAspect}, duas extensões de classes e a definição da interface \textit{ICopyable}. As classes \textit{Room} e \textit{Reservation}são marcadas com o estereótipo \textit{ClassExtension}, para sinalizar que estão sendo estendidas pelo aspecto. A primeira extensão adicionada asclasses é a implementação da interface \textit{ICopyable}, que define dois métodos para um objeto ter a capacidade de ser copiável. Como a interface\textit{ICopyable} exige a implementação de dois métodos, o aspecto introduz os métodos \textit{copy()} e \textit{deepCopy()} nas classes \textit{Room} e \textit{Reservation}. A realização da interface \textit{ICopyable} em ambas as classes e os métodos introduzidos são marcados com o estereótipo \textit{Introduction}.\begin{figure}[!h] \centering	\includegraphics{img/structural_profile_example.png}	\caption{Exemplo de Modelagem Estrutural: Interesse Entrecortante \textit{Copyable}.}\label{fig:structural_profile_example}\end{figure}Besides inter-type declarations and aspect configurations, an aspect contains pointcuts and advices. Evermann{'}s profile\cite{Evermann:2007:MSP:1229375.1229379} represents pointcuts within the aspect definition, but without the possibility of capturing multiple joinpoints in the pointcut specification. Our approach represents pointcuts with the UML state machine diagram. Each transition represents the capture ofone or more join points, with the possibility of using wildcards. If the capture of all the join points is satisfied, that is, if the conditions fortriggering a transition are satisfied, it is considered that the system has met a certain pointcut. The stereotype \textit{StatePointcut} extends(\textit{State}) and represents a pointcut. The composition of pointcuts is achieved by composing different state machines. The stereotype thatrepresents pointcuts can be seen in the bottom right of figure \ref{fig:uml_profile}. Figure \ref{fig:pointcut_definition_1} shows the definition ofpointcuts using the proposed approach. The pointcut \textit{AnyCall} captures calls (\textit{call} pointcut) to any method of any class, using awildcard to match any return type, any class and any method name with any number of parameters. The pointcut \textit{RoomTarget} captures theoccurences of a call when the target object (\textit{target} pointcut) is of the type \textit{Room}. Each pointcut is represented as a state in thestate machine diagram. The pointcut signature is specified in the transition, which allows the use of wildcards to capture multiple joinpoints. Whenthe pointcut state is reached, it means that the system has captured the execution points specified by the pointcut signature in the transition label.\begin{figure}[h]	\centering	\includegraphics{img/pointcut_definition_1.png}	\caption{The definition of two	pointcuts.}\label{fig:pointcut_definition_1}\end{figure}